name: Build and Push to Artifactory

on:
  # push:
  #  branches:
  #    - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      actions: read
      contents: read
      attestations: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup JFrog CLI
      uses: jfrog/setup-jfrog-cli@v4
      env:
        JF_URL: ${{ vars.JF_URL }}
        JF_ACCESS_TOKEN: ${{ secrets.JF_ACCESS_TOKEN }}

    - name: Push to Artifactory
      id: build
      # TODO

    
    - name: Generate provenance attestation
      uses: actions/attest-build-provenance@v2
      with:
        subject-name: ${{ steps.build.outputs.artifact_subject_name }}
        subject-digest: sha256:${{ steps.build.outputs.artifact_digest }}